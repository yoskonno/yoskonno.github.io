{"componentChunkName":"component---src-templates-post-js","path":"/2019/02/04/gcc-failed-when-installing-mod-wsgi/","result":{"data":{"wordpressPost":{"id":"7697343e-ed5c-5f39-8804-5521aca10efa","title":"mod_wsgi インストール中に gcc failed","excerpt":"<p>背景 以前、以下のエントリーで、Caffe のモデルを使った API サーバーを構築する方法を紹介しました。 機械学習の学習済みモデルを使用して API サーバーを構築する | もばらぶエンジニアブログ その後、都合によ [&hellip;]</p>\n","slug":"gcc-failed-when-installing-mod-wsgi","content":"\n<h2>背景</h2>\n\n\n\n<p>以前、以下のエントリーで、Caffe のモデルを使った API サーバーを構築する方法を紹介しました。</p>\n\n\n\n<p><a href=\"https://stg-engineering-wp.mobalab.net/2019/01/10/develop-api-server-with-pre-trained-ml-model/\">機械学習の学習済みモデルを使用して API サーバーを構築する | もばらぶエンジニアブログ</a></p>\n\n\n\n<p>その後、都合により別のサーバーに移行することになったのですが、そこでいくつか問題が発生したので、それの対処法を紹介します。移行前の環境等の詳しい情報は上のエントリーをご参照下さい。</p>\n\n\n\n<p>その他の問題に関しては、別エントリーに記載しました。</p>\n\n\n\n<ul><li><a href=\"https://stg-engineering-wp.mobalab.net/2019/02/05/mod-wsgi-w-anaconda-caused-undefined-symbol-sslv2-method/\">mod_wsgi + Anaconda で undefined symbol: SSLv2_method | もばらぶエンジニアブログ</a></li><li>（第三弾は近日公開予定）</li></ul>\n\n\n\n<h2>（移行後の）環境</h2>\n\n\n\n<ul><li>AWS Deep Learning AMI (Ubuntu、移行前は Amazon Linux 版の DL AMI)</li><li>その他の環境は変わらず<ul><li><code>caffe_p27</code> 環境</li><li>Apache 2.4</li><li>etc.</li></ul></li></ul>\n\n\n\n<h2>エラーとその原因</h2>\n\n\n\n<p>以下のコマンドで mod_wsgi をインストールすると、</p>\n\n\n<pre class=\"brush: plain; title: ; notranslate\" title=\"\">\nsource activate caffe_p27\npip install mod_wsgi\n</pre>\n\n\n<p>以下のエラーが出ました。（完全なエラーは本ページ末尾に記載。）</p>\n\n\n<pre class=\"brush: plain; title: ; notranslate\" title=\"\">\n  gcc: error: unrecognized command line option ‘-Wdate-time’\n  gcc: error: unrecognized command line option ‘-fstack-protector-strong’\n  error: command 'gcc' failed with exit status 1\n</pre>\n\n\n<p>原因は、Anaconda の gcc が 4.8 なので、上に書かれているオプションが存在しないのが原因らしいです。</p>\n\n\n\n<h2>対処法</h2>\n\n\n\n<p>結論から言うと、gcc 5 を使う事で解決しました。具体的には以下のようにしました。</p>\n\n\n<pre class=\"brush: plain; title: ; notranslate\" title=\"\">\nconda install -c psi4 gcc-5\npip install mod_wsgi\n</pre>\n\n\n<p>この <code>gcc-5</code> ってパッケージ？をインストールすると、システムに入ってる <code>gcc</code>が使われるようになりました。これは、意図されている動作なのかは分からないのですが、とりあえず問題は解決したので良しとしましょう。</p>\n\n\n<pre class=\"brush: plain; title: ; notranslate\" title=\"\">\n(caffe_p27) ubuntu@ip-172-31-5-255:~$ which gcc\n/usr/bin/gcc\n(caffe_p27) ubuntu@ip-172-31-5-255:~$ gcc --version\ngcc (Ubuntu 5.4.0-6ubuntu1~16.04.11) 5.4.0 20160609\nCopyright (C) 2015 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</pre>\n\n\n<h2>まとめ・雑感</h2>\n\n\n\n<p>同じ AWS Deep Learning AMI だから、Amazon Linux -&gt; Ubuntu とは言え移行作業は大して難しくないだろうと思っていたのですが、意外にハマりどころが多かったです。これ以外にもいくつかの問題点があったので、それらについては別エントリーとして記載します。</p>\n\n\n\n<h2>詳細なエラー</h2>\n\n\n<pre class=\"brush: plain; title: ; notranslate\" title=\"\">\n$ pip install mod_wsgi\nCollecting mod_wsgi\n  Downloading https://files.pythonhosted.org/packages/47/69/5139588686eb40053f8355eba1fe18a8bee94dc3efc4e36720c73e07471a/mod_wsgi-4.6.5.tar.gz (490kB)\n    100% |████████████████████████████████| 491kB 2.3MB/s\nBuilding wheels for collected packages: mod-wsgi\n  Running setup.py bdist_wheel for mod-wsgi ... error\n  Complete output from command /home/ubuntu/anaconda3/envs/caffe_p27/bin/python -u -c &quot;import setuptools, tokenize;__file__='/tmp/pip-build-iLuEnG/mod-wsgi/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))&quot; bdist_wheel -d /tmp/tmpd28w8Npip-wheel- --python-tag cp27:\n  /home/ubuntu/anaconda3/envs/caffe_p27/lib/python2.7/distutils/dist.py:267: UserWarning: Unknown distribution option: 'bugtrack_url'\n    warnings.warn(msg)\n  running bdist_wheel\n  running build\n  running build_py\n  creating build\n  creating build/lib.linux-x86_64-2.7\n  creating build/lib.linux-x86_64-2.7/mod_wsgi\n  copying src/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi\n  creating build/lib.linux-x86_64-2.7/mod_wsgi/server\n  copying src/server/apxs_config.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server\n  copying src/server/environ.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server\n  copying src/server/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server\n  creating build/lib.linux-x86_64-2.7/mod_wsgi/server/management\n  copying src/server/management/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server/management\n  creating build/lib.linux-x86_64-2.7/mod_wsgi/server/management/commands\n  copying src/server/management/commands/runmodwsgi.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server/management/commands\n  copying src/server/management/commands/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server/management/commands\n  creating build/lib.linux-x86_64-2.7/mod_wsgi/docs\n  copying docs/_build/html/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/docs\n  creating build/lib.linux-x86_64-2.7/mod_wsgi/images\n  copying images/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/images\n  copying images/snake-whiskey.jpg -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/images\n  running build_ext\n  building 'mod_wsgi.server.mod_wsgi-py27' extension\n  creating build/temp.linux-x86_64-2.7\n  creating build/temp.linux-x86_64-2.7/src\n  creating build/temp.linux-x86_64-2.7/src/server\n  gcc -pthread -B /home/ubuntu/anaconda3/envs/caffe_p27/compiler_compat -Wl,--sysroot=/ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/usr/include/apache2 -I/home/ubuntu/anaconda3/envs/caffe_p27/include/python2.7 -c src/server/wsgi_stream.c -o build/temp.linux-x86_64-2.7/src/server/wsgi_stream.o -I/usr/include/apache2 -I. -I/usr/include/apr-1.0 -I/usr/include -DBUILD_DATETIME='&quot;2018-06-07T19:43:03&quot;' -Wdate-time -D_FORTIFY_SOURCE=2 -DLINUX -D_REENTRANT -D_GNU_SOURCE -pipe -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -pthread -I/usr/include/apr-1.0 -I/usr/include/apr-1.0 -I/usr/include\n  gcc: error: unrecognized command line option ‘-Wdate-time’\n  gcc: error: unrecognized command line option ‘-fstack-protector-strong’\n  error: command 'gcc' failed with exit status 1\n\n  ----------------------------------------\n  Failed building wheel for mod-wsgi\n  Running setup.py clean for mod-wsgi\nFailed to build mod-wsgi\nInstalling collected packages: mod-wsgi\n  Running setup.py install for mod-wsgi ... error\n    Complete output from command /home/ubuntu/anaconda3/envs/caffe_p27/bin/python -u -c &quot;import setuptools, tokenize;__file__='/tmp/pip-build-iLuEnG/mod-wsgi/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))&quot; install --record /tmp/pip-0PKhF7-record/install-record.txt --single-version-externally-managed --compile:\n    /home/ubuntu/anaconda3/envs/caffe_p27/lib/python2.7/distutils/dist.py:267: UserWarning: Unknown distribution option: 'bugtrack_url'\n      warnings.warn(msg)\n    running install\n    running build\n    running build_py\n    creating build\n    creating build/lib.linux-x86_64-2.7\n    creating build/lib.linux-x86_64-2.7/mod_wsgi\n    copying src/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi\n    creating build/lib.linux-x86_64-2.7/mod_wsgi/server\n    copying src/server/apxs_config.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server\n    copying src/server/environ.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server\n    copying src/server/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server\n    creating build/lib.linux-x86_64-2.7/mod_wsgi/server/management\n    copying src/server/management/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server/management\n    creating build/lib.linux-x86_64-2.7/mod_wsgi/server/management/commands\n    copying src/server/management/commands/runmodwsgi.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server/management/commands\n    copying src/server/management/commands/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/server/management/commands\n    creating build/lib.linux-x86_64-2.7/mod_wsgi/docs\n    copying docs/_build/html/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/docs\n    creating build/lib.linux-x86_64-2.7/mod_wsgi/images\n    copying images/__init__.py -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/images\n    copying images/snake-whiskey.jpg -&gt; build/lib.linux-x86_64-2.7/mod_wsgi/images\n    running build_ext\n    building 'mod_wsgi.server.mod_wsgi-py27' extension\n    creating build/temp.linux-x86_64-2.7\n    creating build/temp.linux-x86_64-2.7/src\n    creating build/temp.linux-x86_64-2.7/src/server\n    gcc -pthread -B /home/ubuntu/anaconda3/envs/caffe_p27/compiler_compat -Wl,--sysroot=/ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/usr/include/apache2 -I/home/ubuntu/anaconda3/envs/caffe_p27/include/python2.7 -c src/server/wsgi_stream.c -o build/temp.linux-x86_64-2.7/src/server/wsgi_stream.o -I/usr/include/apache2 -I. -I/usr/include/apr-1.0 -I/usr/include -DBUILD_DATETIME='&quot;2018-06-07T19:43:03&quot;' -Wdate-time -D_FORTIFY_SOURCE=2 -DLINUX -D_REENTRANT -D_GNU_SOURCE -pipe -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -pthread -I/usr/include/apr-1.0 -I/usr/include/apr-1.0 -I/usr/include\n    gcc: error: unrecognized command line option ‘-Wdate-time’\n    gcc: error: unrecognized command line option ‘-fstack-protector-strong’\n    error: command 'gcc' failed with exit status 1\n\n    ----------------------------------------\nCommand &quot;/home/ubuntu/anaconda3/envs/caffe_p27/bin/python -u -c &quot;import setuptools, tokenize;__file__='/tmp/pip-build-iLuEnG/mod-wsgi/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))&quot; install --record /tmp/pip-0PKhF7-record/install-record.txt --single-version-externally-managed --compile&quot; failed with error code 1 in /tmp/pip-build-iLuEnG/mod-wsgi/\nYou are using pip version 9.0.3, however version 19.0.1 is available.\nYou should consider upgrading via the 'pip install --upgrade pip' command.\n</pre>\n\n\n<p><br></p>\n\n\n\n<p><br></p>\n","dateObject":"2019-02-04T02:28:22.000Z","date":"February 04, 2019","categories":[{"name":"Uncategorized","slug":"uncategorized"}],"tags":[{"name":"AWS Deep Learning AMI","slug":"aws-deep-learning-ami"},{"name":"gcc","slug":"gcc"},{"name":"mod_wsgi","slug":"mod_wsgi"}],"author":{"name":"中の人（管理者）","slug":"engineering_8qmk0b"},"featured_media":{"media_details":{"sizes":{"large":{"source_url":"https://i0.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2019/02/1280px-GNU_Compiler_Collection_logo-failed.png?fit=868%2C1024&ssl=1","height":1024,"width":868},"medium_large":{"source_url":"https://i0.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2019/02/1280px-GNU_Compiler_Collection_logo-failed.png?fit=768%2C906&ssl=1","height":906,"width":768}}},"source_url":"https://stg-engineering-wp.mobalab.net/wp-content/uploads/2019/02/1280px-GNU_Compiler_Collection_logo-failed.png"},"wordpress_id":547}},"pageContext":{"id":"7697343e-ed5c-5f39-8804-5521aca10efa","nextPath":"/2019/01/31/we-are-hiring/","nextTitle":"優秀な技術者と一緒に、好きな場所で働きませんか","prevPath":"/2019/02/05/mod-wsgi-w-anaconda-caused-undefined-symbol-sslv2-method/","prevTitle":"mod_wsgi + Anaconda で undefined symbol: SSLv2_method"}}}