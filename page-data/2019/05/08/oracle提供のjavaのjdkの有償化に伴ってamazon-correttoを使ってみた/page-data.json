{"componentChunkName":"component---src-templates-post-js","path":"/2019/05/08/oracle提供のjavaのjdkの有償化に伴ってamazon-correttoを使ってみた/","result":{"data":{"wordpressPost":{"id":"d08d59a7-f42c-5e4c-8823-975add686889","title":"Oracle提供のJavaのJDKの有償化に伴ってAmazon Correttoを使ってみた","excerpt":"<p>はじめに みなさんこんにちは。時の流れは速いもので、気づいたら平成が終わって令和が始まり、10日もあったゴールデンウィークもあっというまに終わってしまいました。 平成が終わる前にOracle提供のJava JDKの無償で [&hellip;]</p>\n","slug":"oracle%e6%8f%90%e4%be%9b%e3%81%aejava%e3%81%aejdk%e3%81%ae%e6%9c%89%e5%84%9f%e5%8c%96%e3%81%ab%e4%bc%b4%e3%81%a3%e3%81%a6amazon-corretto%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f","content":"\n<h2>はじめに</h2>\n\n\n\n<p>みなさんこんにちは。時の流れは速いもので、気づいたら平成が終わって令和が始まり、10日もあったゴールデンウィークもあっというまに終わってしまいました。<br><br>平成が終わる前にOracle提供のJava JDKの無償での提供も終わってしまったようですが、それに代わりAmazon Correttoという代替手段を無事導入することができましたので記事にしてみました。</p>\n\n\n\n<h2>2019年4月16日から、Oracle提供のJavaのJDKが有償化された</h2>\n\n\n\n<p><a href=\"https://commet.cc\">弊社のこちらのサービス</a>のVagrantの開発環境を新規でセットアップしようとしたところ、以前は問題がなかった部分でエラーが発生し、もともと使っていたOracleのJava 8のJDKのダウンロードリンクが404を返していることがわかりました。<br><br>確認すると、これまでOracleによって商用も含めて無償で提供されていたJava 8のJDKが2019年4月16日以降OracleのOTNライセンスの取得を必須とするようになり、これに伴いJava JDKの商用での利用は有償化となり、これまでと提供方法が大きく変わったことでこれまで利用可能だったダウロードリンクも利用できなくなっているようでした。 </p>\n\n\n\n<p>そこでオープンソースのJavaのOpenJDK 8への切り替え、またはAmazonによるOpenJDK 8のディストリビューションであるAmazon Corretto 8への切り替えという選択肢が考えられましたが、今回の対応ではAmazonによるLTSが提供されているAmazon Correttoを使用することにしました。 </p>\n\n\n\n<h2>Amazon Correttoとは</h2>\n\n\n\n<p><a href=\"https://aws.amazon.com/jp/corretto/\">https://aws.amazon.com/jp/corretto/</a><br><br> Amazon CorrettoはAmazonが提供するLTS(Long term support)付きの無償のOpenJDKのディストリビューションです。OpenJDKとの大きな違いは、Amazonによるパフォーマンスの向上とセキュリティの問題に対する不具合の修正などを含むサポート（少なくともCorretto 8 の場合は 2023 年 6 月まで）を用意しているLTS付きのものであるということです。<br></p>\n\n\n\n<p>ドキュメントによると、OpenJDKにはまだ統合されていないAmazonが提供するパッチを含み、特にパフォーマンスと安定化の向上のためのパッチに焦点を当てているとのことで、すでにAmazonの内部で使用されている数千のサービスでCorrettoが使用されているそうで、これらのことを考えるとOpenJDKよりもパフォーマンスや安全性に期待できると言えそうです。<br></p>\n\n\n\n<p> 以下の公式FAQに詳しく内容が記載されていますが、こちらのFAQの内容とCorrettoのGithubレポジトリの内容を見る限りですとAmazon自身でのパッチの提供もしているようでした。<br><br><a href=\"https://aws.amazon.com/corretto/faqs/\">https://aws.amazon.com/corretto/faqs/</a><br><a href=\"https://github.com/corretto/corretto-8\">https://github.com/corretto/corretto-8</a><br></p>\n\n\n\n<p>また、プラットフォームに関してもDocumentによると以下のものへの対応がされているようです。</p>\n\n\n\n<ul><li>Linux</li><li>Windows</li><li>macOS</li><li>Docker </li></ul>\n\n\n\n<h2>Vagrant + Ansible + Ubuntuの環境でのAmazon Correttoの導入の方法</h2>\n\n\n\n<p>今回Java8が必要になった弊社のサービスでのVagrant + Ansible + Ubuntuの環境でAmazon Correttoを導入しましたので、具体的にどのようなコードで導入したのかを共有します。</p>\n\n\n\n<p>環境構築時に実行されるAnsibleのタスクで、もともとOracle JDKでJava8をインストールしていた部分を以下のような流れで書き換えました。</p>\n\n\n\n<ol><li><em> Oracle JDKがインストールされているかチェック<br>↓</em></li><li><em>（インストールされていたら）Oracle JDKをアンインストール<br>↓</em></li><li><em>  java-commonのパッケージをインストール <br>↓</em></li><li><em>  Amazon Correttoがインストールされているかチェック<br>↓</em></li><li><em>（インストールされていなかったら）Amazon Correttoをインストール </em></li></ol>\n\n\n\n<p>「java-commonのパッケージのインストールする」と「Amazon Correttoをインストール 」という部分ですが、以下のCorrettoのドキュメントのLinuxにおける導入ガイドにしたがっています。<br><a href=\"https://docs.aws.amazon.com/corretto/latest/corretto-8-ug/generic-linux-install.html\">https://docs.aws.amazon.com/corretto/latest/corretto-8-ug/generic-linux-install.html</a></p>\n\n\n\n<h3>Java 8導入部分のAnsibleのコード</h3>\n\n\n\n<pre class=\"wp-block-code\"><code># 1. Oracle JDKがインストールされているかチェック \n- name: Check if Oracle JDK is installed\n  shell: dpkg-query -l oracle-java8-installer\n  register: oracle_jdk_installed\n  failed_when: no\n  tags: java\n\n# 2. （インストールされていたら）Oracle JDKをアンインストール\n- name: Uninstall Oracle JDK\n  apt:\n    pkg: oracle-java8-installer\n    state: absent\n    purge: yes\n    force: yes\n  when: oracle_jdk_installed.rc == 0 # 0 = installed, 1 = not installedなので、installedのときだけ削除している。\n  tags: java\n\n# 3. java-commonのパッケージをインストール \n- apt: name=java-common\n  tags: java\n\n# 4. Amazon Correttoがインストールされているかチェック \n- name: Check if Amazon Corretto is installed\n  command: dpkg-query -W java-1.8.0-amazon-corretto-jdk\n  register: corretto_installed\n  failed_when: corretto_installed.rc > 1\n  tags: java\n\n# 5. （インストールされていなかったら）Amazon Correttoをインストール \n- name: Install Amazon Corretto\n  apt:\n    deb: https://d3pxv6yz143wms.cloudfront.net/8.212.04.1/java-1.8.0-amazon-corretto-jdk_8.212.04-1_amd64.deb\n  when: corretto_installed.rc == 1 # 0 = installed, 1 = not installedなので、not installedのときだけインストールしている。\n  tags: java</code></pre>\n\n\n\n<h2>まとめ</h2>\n\n\n\n<p>OpenJDKとは異なりJavaの最新バージョンのJava 12に対応したバージョンなどは出ていないようで、まだ予定もないようです。しかし、既存のJava 8またはJava 11環境でOracleの提供するJava JDKが有償化になってしまったことで切り替えの必要がある人にとっては優れた代替手段となりそうなAmazon Correttoでした。皆様も是非お試しください。</p>\n","dateObject":"2019-05-08T12:40:19.000Z","date":"May 08, 2019","categories":[{"name":"Uncategorized","slug":"uncategorized"}],"tags":[{"name":"amazon","slug":"amazon"},{"name":"corretto","slug":"corretto"},{"name":"java","slug":"java"},{"name":"jdk","slug":"jdk"}],"author":{"name":"Konno","slug":"konno"},"featured_media":{"media_details":{"sizes":{"large":null,"medium_large":{"source_url":"https://i0.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2019/05/amazon-smile-1.png?fit=768%2C434&ssl=1","height":434,"width":768}}},"source_url":"https://stg-engineering-wp.mobalab.net/wp-content/uploads/2019/05/amazon-smile-1.png"},"wordpress_id":844}},"pageContext":{"id":"d08d59a7-f42c-5e4c-8823-975add686889","nextPath":"/2019/04/15/try-rubymine-2019-1-new-feature/","nextTitle":"RubyMine 2019.1でRailsをdocker exec経由で起動可能になったがバグあって使い物にならない件","prevPath":"/2019/05/10/python-3-6-の環境を構築してvisual-studio-code-でコーディングする/","prevTitle":"Python 3.6 の環境を構築してVisual Studio Code でコーディングする"}}}