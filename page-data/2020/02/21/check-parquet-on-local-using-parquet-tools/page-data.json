{"componentChunkName":"component---src-templates-post-js","path":"/2020/02/21/check-parquet-on-local-using-parquet-tools/","result":{"data":{"wordpressPost":{"id":"ba8c9f4b-9193-5b43-8ebe-a7c2d8e96af3","title":"parquet-toolsでApache Parquet形式のファイルをローカルでお手軽に確認する","excerpt":"<p>こんにちは、皆さんお久しぶりです。最後のエントリからだいぶ期間が空いてしまいましたが、これからちょくちょくまた書いていきますので宜しくお願いします。 さて今回ですが、小ネタになってしまい恐縮ですが、タイトルの通りApac [&hellip;]</p>\n","slug":"check-parquet-on-local-using-parquet-tools","content":"\n<p>こんにちは、皆さんお久しぶりです。最後のエントリからだいぶ期間が空いてしまいましたが、これからちょくちょくまた書いていきますので宜しくお願いします。</p>\n\n\n\n<p>さて今回ですが、小ネタになってしまい恐縮ですが、タイトルの通りApache Parquetのファイルをローカルで手軽に確認できるparquet-toolsの紹介をしようと思います。</p>\n\n\n\n<h2>parquet-tools</h2>\n\n\n\n<p><a href=\"https://github.com/apache/parquet-mr/tree/master/parquet-tools\">https://github.com/apache/parquet-mr/tree/master/parquet-tools</a></p>\n\n\n\n<p>まさに今回の要件を満たしてくれるツールになります。基本的にParquetを使う際は巨大なデータになる事が多いのでHadoopのクラスタを立ち上げて確認する事が多いのですが、ごく小さい単一のParquet等、クラスタを立ち上げるまでもない時に便利かもしれません。</p>\n\n\n\n<p>Javaでできているようで、使用するには自前でコンパイルするか、macOSのユーザーであればHomebrewでインストールが可能です。僕はHomebrewを使いました:</p>\n\n\n\n<pre class=\"wp-block-code\"><code>brew install parquet-tools</code></pre>\n\n\n\n<h2>使い方</h2>\n\n\n\n<p><code>parquet-tools</code> を実行するとusageが表示されます。以下はざっくりとしたまとめですがこのようなサブコマンドがあるようです:</p>\n\n\n\n<pre class=\"wp-block-code\"><code>parquet-tools cat: Parquetの行を全件出力。メタデータは表示されない\nparquet-tools head: 最初のn行を出力\nparquet-tools schema: スキーマ情報を出力\nparquet-tools meta: メタデータを出力\nparquet-tools dump: メタデータと行の全件を出力\nparquet-tools merge: 複数のParquetファイルをマージする\nparquet-tools rowcount: 行数を出力する\nparquet-tools size: Parquetファイルのサイズを出力</code></pre>\n\n\n\n<p>今回のケースで使いそうなのは <code>cat</code>, <code>rowcount</code>, <code>schema</code> くらいなのでこれらを試してみましょう。</p>\n\n\n\n<p>まずは <code>schema</code> から (対象ファイルはsnappy圧縮されていましたが大丈夫でした):</p>\n\n\n\n<pre class=\"wp-block-code\"><code>$ parquet-tools schema ~/Downloads/part-00000-xyz.snappy.parquet\n\nmessage spark_schema {\n  optional int32 user_id;\n  optional binary name (UTF8);\n  optional binary birthdate (UTF8)\n  optional int32 gender;\n}</code></pre>\n\n\n\n<p>次に行数を見てみます: </p>\n\n\n\n<pre class=\"wp-block-code\"><code>$ parquet-tools rowcount ~/Downloads/part-00000-xyz.snappy.parquet\n\nTotal RowCount: 8</code></pre>\n\n\n\n<p>ではいよいよ <code>cat</code> で中身を見てみましょう:</p>\n\n\n\n<pre class=\"wp-block-code\"><code>$ parquet-tools cat ~/Downloads/part-00000-xyz.snappy.parquet\n\nuser_id = 1\nname = Jiro Yamada\nbirthdate = 1990-01-12\ngender = 1\n\nuser_id = 2\nname = Taro Tanaka\nbirthdate = 1987-11-12\ngender = 2\n\n...\n\nuser_id = 8\nname = Shiro Kimura\nbirthdate = 1978-09-29\ngender = 1</code></pre>\n\n\n\n<p><code>cat</code> は <code>--json</code> オプションでJSON出力も可能です:</p>\n\n\n\n<pre class=\"wp-block-code\"><code>$ parquet-tools cat --json ~/Downloads/part-00000-xyz.snappy.parquet\n\n{\"user_id\":1,\"name\":\"Jiro Yamada\",\"birthdate\":\"1990-01-12\",\"gender\":1}\n{\"user_id\":2,\"name\":\"Taro Tanaka\",\"birthdate\":\"1987-11-12\",\"gender\":2}\n...\n{\"user_id\":8,\"name\":\"Shiro Kimura\",\"birthdate\":\"1978-09-29\",\"gender\":1}</code></pre>\n\n\n\n<h2>まとめ</h2>\n\n\n\n<p>と言う訳で、parquet-toolsを使った小さなParquetファイルの中身の確認方法を紹介しました。あまり使う頻度は高くないかと思いますが、ローカルでさくっと確認したい時にいかがでしょうか。個人的には<code>cat</code>\bがCSV出力に対応しているともっと便利だと思いました（jqとか使えばいけますが・・・）</p>\n","dateObject":"2020-02-21T03:00:00.000Z","date":"February 21, 2020","categories":[{"name":"Uncategorized","slug":"uncategorized"}],"tags":[{"name":"Apache Parquet","slug":"apache-parquet"},{"name":"CLI","slug":"cli"},{"name":"parquet-tools","slug":"parquet-tools"}],"author":{"name":"issei_m","slug":"issei"},"featured_media":{"media_details":{"sizes":{"large":{"source_url":"https://i2.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/02/apache-parquet-eyecatch.png?fit=1024%2C576&ssl=1","height":576,"width":1024},"medium_large":{"source_url":"https://i2.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/02/apache-parquet-eyecatch.png?fit=768%2C432&ssl=1","height":432,"width":768}}},"source_url":"https://stg-engineering-wp.mobalab.net/wp-content/uploads/2020/02/apache-parquet-eyecatch.png"},"wordpress_id":1330}},"pageContext":{"id":"ba8c9f4b-9193-5b43-8ebe-a7c2d8e96af3","nextPath":"/2019/12/06/how-to-learn-technology/","nextTitle":"個人的な技術習得方法","prevPath":"/2020/02/26/provision-elastic-beanstalk-environment-by-terraform/","prevTitle":"Elastic Beanstalk 環境を Terraform で構築する"}}}