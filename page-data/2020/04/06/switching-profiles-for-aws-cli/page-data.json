{"componentChunkName":"component---src-templates-post-js","path":"/2020/04/06/switching-profiles-for-aws-cli/","result":{"data":{"wordpressPost":{"id":"b4270e80-790e-59e6-88ec-0b7b046c28ac","title":"AWS CLI のプロファイル切り替え関連","excerpt":"<p>業務で AWS を使っていると、複数の AWS のアカウント/ユーザーを切り替える事が多いと思います。AWS CLI で使うアカウント/ユーザーを切り替えるには、プロファイルという仕組みを使いますが、今回はそれに関して書 [&hellip;]</p>\n","slug":"switching-profiles-for-aws-cli","content":"\n<p>業務で AWS を使っていると、複数の AWS のアカウント/ユーザーを切り替える事が多いと思います。AWS CLI で使うアカウント/ユーザーを切り替えるには、プロファイルという仕組みを使いますが、今回はそれに関して書きます。</p>\n\n\n\n<p>なお、初心者向けの簡単な内容の項目は、見出しに「（初心者向け）」と明記しておきますので、中〜上級者は飛ばして下さい。</p>\n\n\n\n<h2>初期設定（初心者向け）</h2>\n\n\n\n<p>AWS CLI を使う際には、 <code>aws configure</code> コマンドで初期設定します。方法は、以下のページに記載されているので、そちらを参照して下さい。</p>\n\n\n\n<p><a href=\"https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration\">AWS CLI の設定 &#8211; AWS Command Line Interface</a></p>\n\n\n\n<p>AWS 環境が1つしかない場合は、<code>aws configure</code> コマンドを引数無しで実行して、デフォルトのプロファイルを作成しますが、複数の環境を切り替えたい場合は、<code>aws configure --profile プロファイル名</code> という形でプロファイルを作成します。これも、上のページに記載されています。</p>\n\n\n\n<h2>プロファイルの切り替え方（初心者向け）</h2>\n\n\n\n<p>複数のプロファイルをどうやって切り替えるかですが、具体的には2通りの方法があります。</p>\n\n\n\n<ul><li>環境変数にプロファイル名を設定する</li><li>コマンドのオプションでプロファイル名を指定する</li></ul>\n\n\n\n<p>前者は、 <code>AWS_PROFILE</code> 環境変数などに値を設定して、コマンドを実行します。例えば以下のような形です。</p>\n\n\n<pre class=\"brush: plain; title: ; notranslate\" title=\"\">\nexport AWS_PROFILE=foo-system-production\naws s3 ls\n</pre>\n\n\n<p>後者の例としては以下の通りです。</p>\n\n\n<pre class=\"brush: plain; title: ; notranslate\" title=\"\">\naws s3 ls --profile foo-system-production\n</pre>\n\n\n<h2>設定すべき環境変数が色々ある</h2>\n\n\n\n<p>どのような環境変数を設定すると AWS CLI がどう動作するかは、以下のページに記載があります。</p>\n\n\n\n<p><a href=\"https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-envvars.html\">AWS CLI を設定する環境変数 &#8211; AWS Command Line Interface</a></p>\n\n\n\n<p>ただ、いくつか注意点があるので、以下に記載します。</p>\n\n\n\n<h3>AWS_DEFAULT_PROFILE は使ってはいけない</h3>\n\n\n\n<p><code>AWS_PROFILE</code> は、以前は <code>AWS_DEFAULT_PROFILE</code> という名前だったようですが、現在は <code>AWS_DEFAULT_PROFILE</code> はドキュメントにもありませんし、使わない方が良いでしょう。</p>\n\n\n\n<h3>EB CLI の場合、AWS_EB_PROFILE</h3>\n\n\n\n<p>Elastic Beanstalk をコマンドラインから使う場合には、EB CLI という AWS CLI とは別のツールを使う必要があります。そして、使う環境変数も <code>AWS_EB_PROFILE</code> という違う名前です。</p>\n\n\n\n<p><a href=\"https://docs.aws.amazon.com/ja_jp/elasticbeanstalk/latest/dg/eb-cli3-configuration.html\">EB CLI の設定 &#8211; AWS Elastic Beanstalk</a></p>\n\n\n\n<p>正直、統一して欲しいところです。</p>\n\n\n\n<p>環境変数名が違うのはドキュメントに記載されているのですが、私は読み飛ばしていたため、<code>AWS_PROFILE</code> を設定しているのに効かない！としばらく時間を無駄に費やしてしまいました。</p>\n\n\n\n<h2>まとめ</h2>\n\n\n\n<p>AWS のプロファイルを切り替えるには、環境変数を設定するかコマンドラインオプションとして指定する必要があります。環境変数名は、AWS CLI と EB CLI では異なりますので、EB CLI を使う場合には注意して下さい。</p>\n","dateObject":"2020-04-06T02:21:00.000Z","date":"April 06, 2020","categories":[{"name":"Uncategorized","slug":"uncategorized"}],"tags":[{"name":"AWS CLI","slug":"aws-cli"},{"name":"EB CLI","slug":"eb-cli"}],"author":{"name":"中の人（管理者）","slug":"engineering_8qmk0b"},"featured_media":{"media_details":{"sizes":{"large":{"source_url":"https://i1.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/04/aws_logo_smile_1200x630.png?fit=1024%2C538&ssl=1","height":538,"width":1024},"medium_large":{"source_url":"https://i1.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/04/aws_logo_smile_1200x630.png?fit=768%2C403&ssl=1","height":403,"width":768}}},"source_url":"https://stg-engineering-wp.mobalab.net/wp-content/uploads/2020/04/aws_logo_smile_1200x630.png"},"wordpress_id":1411}},"pageContext":{"id":"b4270e80-790e-59e6-88ec-0b7b046c28ac","nextPath":"/2020/04/03/tomcat-9-and-apache-on-centos-7/","nextTitle":"CentOS 7で Tomcat 9 + Apache を動かす","prevPath":"/2020/04/16/set-system-property-via-java-tool-options/","prevTitle":"JAVA_TOOL_OPTIONS環境変数でAWS Lambda関数のシステムプロパティを設定する"}}}