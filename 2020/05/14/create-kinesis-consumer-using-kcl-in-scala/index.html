<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog-foo/styles.f96b5d4417f78d72b46c.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-box-sizing:border-box;box-sizing:border-box}*,:after,:before{-webkit-box-sizing:inherit;box-sizing:inherit}body{color:#4a4a4a;line-height:1.5;font-family:BlinkMacSystemFont,-apple-system,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5{color:#2d2d2d;font-weight:700;line-height:1.125}a{text-decoration:none;word-break:break-all}img{height:auto;max-width:100%}code,pre{-moz-osx-font-smoothing:auto;-webkit-font-smoothing:auto}pre{background-color:#f1f1f1;font-size:.9rem;overflow:auto;padding:18px 25px!important}code{background-color:#f5f5f5;color:#f14668;font-family:monospace;font-size:1.2rem;font-weight:400;padding:.25em .5em;word-break:break-all}.hljs>code{background-color:unset;color:unset;font-family:unset;font-size:unset;font-weight:unset;padding:unset;word-break:unset}*{-webkit-box-sizing:border-box;box-sizing:border-box}.main-inner{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 auto;max-width:90%;padding-bottom:50px;width:1500px}@media screen and (max-width:767px){.main-inner{max-width:100%}}.container{height:100%;margin:0 auto;max-width:90%;width:1500px}.contents-container{width:75%}@media screen and (max-width:767px){.contents-container{width:100%}}.sidebar-container{width:25%}@media screen and (max-width:767px){.sidebar-container{width:100%}}.section{padding:30px 15px}.section--gray{background-color:#f5f5f5}.banner__image-wrapper{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.banner__image{max-width:300px;width:100%}.banner__image--medium{max-width:600px;padding:15px 30px}.button{border:1px solid #dbdbdb;color:#363636;cursor:pointer;-ms-flex-pack:center;justify-content:center;padding:calc(.5em - 1px) 1em;text-align:center;white-space:nowrap}.button--small{border-radius:2px;font-size:.75rem}.comment__item{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;margin:30px 0}.comment__item-upper{-ms-flex-align:baseline;align-items:baseline;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-pack:justify;justify-content:space-between}.comment__name{font-weight:700}.comment__date{font-size:.85em}.comment__child-container{padding-left:30px}.comment__reply-button{-ms-flex-item-align:start;align-self:flex-start;background:none;border:none;color:#13c4a5;cursor:pointer;font-size:.85em;margin:5px 0;padding:0;text-align:left}.comment__reply-button:focus{outline:none!important}.comment-form{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;max-width:600px}.comment-form__input{border:1px solid #dadada;border-radius:3px;margin:5px 0;padding:5px}.comment-form__sent-message{color:#13c4a5}.comment-form__error-message{color:#ff3030}.comment-form__button{border:none;border-radius:3px;cursor:pointer;height:40px;margin:5px 0}.comment-form__button--sending{opacity:.5}.comment-form__button:focus{outline:none!important}.comment-form__spinner-wrapper{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.comment-form__spinner{background-color:#13c4a5}.footer{background-color:#333;color:#eee}.footer__inner{display:-ms-flexbox;display:flex;padding-top:50px;padding-bottom:50px}@media screen and (max-width:767px){.footer__inner{-ms-flex-direction:column-reverse;flex-direction:column-reverse;padding-top:15px}}.footer__column-container{display:-ms-flexbox;display:flex;-ms-flex:1 1;flex:1 1;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-pack:distribute;justify-content:space-around}.footer__column{margin:0 10px}@media screen and (max-width:1199px){.footer__column{margin-top:40px;padding-left:15px;width:40%}}@media screen and (max-width:767px){.footer__column{margin-top:40px;padding-left:15px;width:100%}}.footer__column-title{border-bottom:2px solid #13c4a5;color:#eee;display:inline-block;font-size:1.2rem;line-height:1.4rem;margin-bottom:15px;margin-top:0}.footer a{color:#eee}.footer__bottom-area{-ms-flex-direction:column;flex-direction:column}.footer__bottom-area,.footer__logo-wrapper{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.footer__logo-wrapper{padding:0 50px}@media screen and (max-width:1199px){.footer__logo-wrapper{padding:0 80px}}@media screen and (max-width:767px){.footer__logo-wrapper{padding:60px 0 30px}}.footer__logo-image{height:120px;width:120px}.footer__copyright{color:#828282;font-size:.8rem;height:30px;line-height:30px}.header{background-color:#fff;border-bottom:1px solid #eee;font-size:1.1rem;width:100%;z-index:10}.header a{color:#4a4a4a}.header__upper{border-bottom:1px solid #eee;height:40px}.header__upper.isFixed{display:none}@media screen and (max-width:767px){.header__upper{height:60px}}.header__upper-inner{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;padding-left:30px}@media screen and (max-width:767px){.header__upper-inner{padding-left:0}}.header__subtitle{margin:0 0 0 15px}@media screen and (max-width:767px){.header__subtitle{font-size:1rem;margin:0 auto;text-align:center}}.header__main{height:75px}.header__main.isFixed{height:40px}@media screen and (max-width:767px){.header__main{height:110px}}.header__main-inner{display:-ms-flexbox;display:flex;padding-left:45px}@media screen and (max-width:767px){.header__main-inner{padding-left:0}}.header__logo-link{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex}@media screen and (max-width:767px){.header__logo-link{-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:space-evenly;justify-content:space-evenly;padding:5px 0;width:100%}}.header__logo-image{height:40px;width:40px}.header__logo-image.isFixed{height:25px;width:25px}.header__logo-text{font-size:1.8rem;margin:0 30px}@media screen and (max-width:767px){.header__logo-text{font-size:1.2rem}}.header__logo-text.isFixed{font-size:1.2rem;margin:0 15px}.header__link-container{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;margin-left:20px}@media screen and (max-width:767px){.header__link-container{display:none}}.header__link{margin:0 15px}.pagination{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-pack:center;justify-content:center;padding:0 30px}.pagination__item{border:1px solid #e4e4e4;border-radius:3px;color:#13c4a5;margin:0 4px 10px}.pagination__dots{color:#2d2d2d}.pagination a{color:#2d2d2d;display:block}.pagination__non-link-content,.pagination a{height:100%;padding:5px 15px;width:100%}.post-link{display:-ms-flexbox;display:flex}.post-link__left{padding-right:10px}.post-link__left,.post-link__right{text-decoration:none!important;width:50%}.post-link__right{padding-left:10px}.post-link__link-text,.post-link__title{text-decoration:none}.post-list{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-pack:start;justify-content:flex-start;width:100%}.post-list__section-title{font-size:1.3rem;margin-bottom:30px;margin-left:-2%;margin-top:0;text-align:center}.post-list__item-wrapper{display:block;width:31%;margin-right:2%;margin-bottom:20px;-webkit-transition:all .3s ease-out;transition:all .3s ease-out}@media screen and (max-width:1023px){.post-list__item-wrapper{margin-left:1%;margin-right:1%;width:48%}}@media screen and (max-width:575px){.post-list__item-wrapper{margin-right:0;width:100%}}.post-list__item-wrapper:hover{-webkit-transform:scale(1.04);transform:scale(1.04)}.post-list__item{border:1px solid #f1f1f1;border-radius:6px;-webkit-box-shadow:0 7px 14px rgba(0,0,0,.07);box-shadow:0 7px 14px rgba(0,0,0,.07);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;height:100%}.post-list__thumbnail{border-radius:6px 6px 0 0;width:100%;padding-bottom:65%;background-position:50%;background-repeat:no-repeat}.post-list__main-area{color:#2d2d2d;display:-ms-flexbox;display:flex;-ms-flex:1 1;flex:1 1;-ms-flex-direction:column;flex-direction:column;padding:15px}.post-list__title{font-size:1.1rem;font-weight:700;line-height:1.5;margin:15px 0}.post-list__small{color:grey;font-size:.8rem;margin:0}.post-list__small a{color:#13c4a5}.post-list__excerpt{margin-top:15px}.post-list__excerpt p{margin:0}.post-list__button-area{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;margin-top:auto;padding-top:10px}.post{line-height:1.7;padding-left:50px;padding-right:50px;font-size:1.1rem}@media screen and (max-width:575px){.post{padding:0}}.post__title{font-size:2.5em!important;margin-top:40px!important}.post__date-and-author{color:grey;margin:30px 0}.post__top-image-wrapper{display:-ms-flexbox;display:flex;max-height:400px;min-height:300px;-ms-flex-pack:center;justify-content:center}.post__top-image{max-height:400px;-o-object-fit:contain;object-fit:contain}.post h2{font-size:1.75em;margin-top:40px;margin-bottom:20px}.post h3,.post h4{margin-top:30px;margin-bottom:15px}.post a{color:#13c4a5;text-decoration:underline}.post a:hover{color:#18d3b1}.post *{word-break:break-word}.sharing-buttons__item{margin:0 3px}.tag__container{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.tag__item{-ms-flex-align:center;align-items:center;background-color:#f3f3f3;border-radius:4px;display:-ms-inline-flexbox;display:inline-flex;font-size:.75rem;height:2em;-ms-flex-pack:center;justify-content:center;line-height:1.5;margin:6px 10px 6px 0;padding-left:.75em;padding-right:.75em;white-space:nowrap}.tag__link{color:#4a4a4a!important;text-decoration:none!important}.widget{margin-bottom:50px;margin-top:50px;padding-left:15px;padding-right:15px}@media screen and (max-width:767px){.widget{padding-left:50px;padding-right:50px}}@media screen and (max-width:575px){.widget{padding-left:15px;padding-right:15px}}.widget__title{font-size:1.2rem}.widget ul{list-style:none;padding-left:0}.widget li{border-top:1px solid #e9e9e9;padding:.7rem 0}.widget li:last-child{border-bottom:1px solid #e9e9e9}.widget a{color:#4a4a4a}.hljs{display:block;overflow-x:auto;padding:.5em;background:#232323;color:#e6e1dc}.hljs-comment,.hljs-quote{color:#bc9458;font-style:italic}.hljs-keyword,.hljs-selector-tag{color:#c26230}.hljs-number,.hljs-regexp,.hljs-string,.hljs-template-variable,.hljs-variable{color:#a5c261}.hljs-subst{color:#519f50}.hljs-name,.hljs-tag{color:#e8bf6a}.hljs-type{color:#da4939}.hljs-attr,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-link,.hljs-symbol{color:#6d9cbe}.hljs-params{color:#d0d0ff}.hljs-attribute{color:#cda869}.hljs-meta{color:#9b859d}.hljs-section,.hljs-title{color:#ffc66d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{color:#e6e1dc;display:inline-block;width:100%}.hljs-deletion{background-color:#600}.hljs-selector-class{color:#9b703f}.hljs-selector-id{color:#8b98ab}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><meta name="generator" content="Gatsby 2.21.21"/><title data-react-helmet="true">Scala + Kinesis Client LibraryでKinesisコンシューマーアプリケーションを作る – もばらぶエンジニアブログ</title><meta data-react-helmet="true" name="robots" content="noindex, nofollow"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:site_name" content="もばらぶエンジニアブログ"/><meta data-react-helmet="true" property="og:locale" content="ja_JP"/><meta data-react-helmet="true" name="twitter:creator" content="@mobalab"/><meta data-react-helmet="true" name="twitter:site" content="@mobalab"/><meta data-react-helmet="true" name="description" content="ここ最近のプロジェクトでKinesisのコンシューマーアプリケーションをScalaで開発・メンテしていたので、何回かに分けてノウハウをメモしておきます。 今回はScalaでKinesis Client Libraryを使 ...
"/><meta data-react-helmet="true" property="og:title" content="Scala + Kinesis Client LibraryでKinesisコンシューマーアプリケーションを作る"/><meta data-react-helmet="true" property="og:description" content="ここ最近のプロジェクトでKinesisのコンシューマーアプリケーションをScalaで開発・メンテしていたので、何回かに分けてノウハウをメモしておきます。 今回はScalaでKinesis Client Libraryを使 ...
"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:image" content="https://stg-engineering-wp.mobalab.net/wp-content/uploads/2020/05/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f313630302f302a5551424b6a4566663175497358483857.png"/><link as="script" rel="preload" href="/blog-foo/webpack-runtime-a0e8eddbaf72c74ae48d.js"/><link as="script" rel="preload" href="/blog-foo/framework-d53df25ab0068ecd1ffc.js"/><link as="script" rel="preload" href="/blog-foo/app-aad2f32fe503f88f81aa.js"/><link as="script" rel="preload" href="/blog-foo/styles-da2d348018617ad0abdc.js"/><link as="script" rel="preload" href="/blog-foo/29107295-3eadfd8d28513cbe1d99.js"/><link as="script" rel="preload" href="/blog-foo/2852872c-266d0f544f9db0fe515a.js"/><link as="script" rel="preload" href="/blog-foo/commons-e1b0c49c3875256839c2.js"/><link as="script" rel="preload" href="/blog-foo/component---src-templates-post-js-9fbfa639a23c74cb9bb9.js"/><link as="fetch" rel="preload" href="/blog-foo/page-data/2020/05/14/create-kinesis-consumer-using-kcl-in-scala/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog-foo/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="header"><div class="header__upper "><div class="header__upper-inner container"><p class="header__subtitle">リモート開発メインのソフトウェア開発企業のエンジニアブログです</p></div></div><div class="header__main "><div class="header__main-inner container"><a class="header__logo-link" href="/blog-foo/"><img class="header__logo-image " src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNDAgMjQwIj48cG9seWdvbiBwb2ludHM9IjAgMjYuNjcgMTMuMzMgMjYuNjcgMTMuMzMgNDAgMCA0MCAwIDY2LjY3IDEzLjMzIDY2LjY3IDEzLjMzIDEwNi42NyAxMDYuNjcgMTA2LjY3IDEwNi42NyA4MCA0MCA4MCA0MCA2Ni42NyAxMDYuNjcgNjYuNjcgMTA2LjY3IDQwIDQwIDQwIDQwIDI2LjY3IDEwNi42NyAyNi42NyAxMDYuNjcgMCAwIDAgMCAyNi42NyIvPjxyZWN0IHg9IjQwIiB5PSIxMzMuMzMiIHdpZHRoPSI2Ni42NyIgaGVpZ2h0PSIyNi42NyIvPjxwb2x5Z29uIHBvaW50cz0iMjYuNjcgMTMzLjMzIDAgMTMzLjMzIDAgMjAwIDI2LjY3IDIwMCA4MCAyMDAgODAgMjEzLjMzIDAgMjEzLjMzIDAgMjQwIDEwNi42NyAyNDAgMTA2LjY3IDE3My4zMyAyNi42NyAxNzMuMzMgMjYuNjcgMTMzLjMzIi8+PHBvbHlnb24gcG9pbnRzPSIxMzMuMzMgMTYwIDE3My4zMyAxNjAgMTczLjMzIDI0MCAyMDAgMjQwIDIwMCAxMzMuMzMgMTMzLjMzIDEzMy4zMyAxMzMuMzMgMTYwIi8+PHJlY3QgeD0iMTMzLjMzIiB5PSIxNzMuMzMiIHdpZHRoPSIyNi42NyIgaGVpZ2h0PSI2Ni42NyIvPjxyZWN0IHg9IjIxMy4zMyIgeT0iMTczLjMzIiB3aWR0aD0iMjYuNjciIGhlaWdodD0iNjYuNjciLz48cmVjdCB4PSIyMDYuNjciIHk9IjEzMy4zMyIgd2lkdGg9IjEzLjMzIiBoZWlnaHQ9IjEzLjMzIi8+PHJlY3QgeD0iMjI2LjY3IiB5PSIxMzMuMzMiIHdpZHRoPSIxMy4zMyIgaGVpZ2h0PSIxMy4zMyIvPjxyZWN0IHg9IjEzMy4zMyIgd2lkdGg9IjI2LjY3IiBoZWlnaHQ9IjEwNi42NyIvPjxyZWN0IHg9IjIwNi42NyIgd2lkdGg9IjEzLjMzIiBoZWlnaHQ9IjEzLjMzIi8+PHJlY3QgeD0iMjI2LjY3IiB3aWR0aD0iMTMuMzMiIGhlaWdodD0iMTMuMzMiLz48cGF0aCBkPSJNMjAwLDBIMTczLjMzVjI2LjY3aDQwVjQwaC00MHY2Ni42N0gyNDBWMjBIMjAwWm0xMy4zMyw4MEgyMDBWNjYuNjdoMTMuMzNaIi8+PC9zdmc+" alt="もばらぶ"/><p class="header__logo-text ">もばらぶエンジニアブログ</p></a><div class="header__link-container"><a class="header__link" href="/blog-foo/">Home</a><a class="header__link" href="https://mobalab.net/recruit/" rel="noopener noreferrer" target="_blank">採用情報</a><a class="header__link" href="/blog-foo/categories/en">English</a></div></div></div></header><main class="main"><div class="main-inner" style="margin-top:0"><div class="contents-container"><div class="post"><section class="section"><div class="post__top-image-wrapper"><img src="https://stg-engineering-wp.mobalab.net/wp-content/uploads/2020/05/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f313630302f302a5551424b6a4566663175497358483857.png" alt="" class="post__top-image"/></div><h1 class="post__title">Scala + Kinesis Client LibraryでKinesisコンシューマーアプリケーションを作る</h1><p class="post__date-and-author">May 14, 2020 - posted by <a href="/blog-foo/author/issei">issei_m</a></p><div>
<p>ここ最近のプロジェクトでKinesisのコンシューマーアプリケーションをScalaで開発・メンテしていたので、何回かに分けてノウハウをメモしておきます。</p>



<p>今回はScalaでKinesis Client Libraryを使って、ストリームのコンシューマアプリケーション実装した内容を簡単に記載します。尚、今回採用したKinesis Client Libraryのバージョンは1.x系となります。</p>



<h2 id="Kinesisデータストリームについてざっくり">Kinesisデータストリームについてざっくり</h2>



<p>AWSによるスケーラブルなフルマネージドのデータストリームサービスで、ログやユーザーアクティビティ等、大量のデータレコードをリアルタイムに処理する事ができます。類似サービスにApache Kafka等があります。<br>Amazon SQSのようなキューサービスとの違いは、コンシューマーがどこまでデータを処理したかをストリーム側が管理しないと言う点です。一度ストリームに投下されたデータは一定期間保管され、その間はいつでも取得する事が可能です。</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/engineering.mobalab.net/wp-content/uploads/2020/05/V9LCiUs.png?fit=1024%2C440&amp;ssl=1" alt="" class="wp-image-1471" srcset="https://i0.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/05/V9LCiUs.png?w=1102&amp;ssl=1 1102w, https://i0.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/05/V9LCiUs.png?resize=300%2C129&amp;ssl=1 300w, https://i0.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/05/V9LCiUs.png?resize=1024%2C440&amp;ssl=1 1024w, https://i0.wp.com/stg-engineering-wp.mobalab.net/wp-content/uploads/2020/05/V9LCiUs.png?resize=768%2C330&amp;ssl=1 768w" sizes="(max-width: 1102px) 100vw, 1102px" /><figcaption>Kinesisデータストリームのイメージ図</figcaption></figure>



<p>また、シャード単位で水平分割する事で、データ量に応じていつでも簡単にスケールイン・アウトする事ができます。<br>詳しくは<a rel="noreferrer noopener" href="https://aws.amazon.com/jp/kinesis/" target="_blank">Amazon Kinesis</a>を参照。</p>



<h2 id="Kinesis-Client-Library-以下KCL-について">Kinesis Client Library (以下KCL) について</h2>



<p><a href="https://github.com/awslabs/amazon-kinesis-client">https://github.com/awslabs/amazon-kinesis-client</a></p>



<p>AWSが公式で公開している、Kinesisのコンシューマーアプリケーションを容易に実装する為のライブラリです。<br>Kinesisも例外なくAPIが公開されているので自前でそれらを駆使して実装する事は可能ですが、Kinesisのコンシューマーアプリケーションは考慮すべき点が膨大にある為、よほどの理由がない限りはKCLを使うようにしましょう。</p>



<p>対応言語はJavaなのでScalaでも使えます。一応、他の言語（Node.jsやRuby, Python）にも展開されていますが、実質的にJVMで動くKCL Daemonを経由する事になるので、JVM言語を使うのが簡単です。</p>



<h3 id="KCLを使うメリット">KCLを使うメリット</h3>



<p>先程も言ったとおりKinesisデータストリームはシャード単位で水平分割するのですが、その場合当然ながらコンシューマアプリケーション側も分割して動作する必要があります。<br>KCLを実装したJVMアプリケーションは、シャードの増減に応じてワーカーをスレッド単位で自動的に増減する事で、均等に処理を割り振る事が可能です。<br>また、コンシューマアプリケーションを実行するプロセスを増やしたり、あるいは実行インスタンスそのものが新たに起動、または停止すると、それぞれのインスタンス上のワーカー同士がよしなに割り当てを譲り合う事で、マシンのスケールアウト・インが容易に可能となっています。</p>



<p>また、その他にもシャード毎に処理したレコード数や遅延ミリ秒等の統計情報をCloudWatchに送信してくれる等の面倒も見てくたりと大変便利です。</p>



<h2 id="KCLの実装の基本">KCLの実装の基本</h2>



<p>主な作業は、Javaで提供されているインターフェース&nbsp;<code>IRecordProcessor</code>&nbsp;を実装する事です。これはレコードプロセッサと呼ばれ、ワーカーの実態となります。1つのレコードプロセッサは1つのシャードに割り当てられます。シャードが10個ある場合、レコードプロセッサも10個立ち上がります。<br>このインターフェースに定義されているメソッドを具体的に実装するのですが、アプリケーションのユースケースによっていくつか注意しないといけない点があります。</p>


<pre class="language-java hljs title: ; notranslate" title="">
public interface IRecordProcessor {
    void initialize(InitializationInput initializationInput);
    void processRecords(ProcessRecordsInput processRecordsInput);
    void shutdown(ShutdownInput shutdownInput);
}
</pre>


<h4 id="initialize">initialize</h4>



<p>レコードプロセッサが初期化されると実行されます。タイミングとしては最初にアプリケーションを起動した時や、シャードが増加、または実行インスタンスが増加した際に新しく割り当てが起きた場合等です。&nbsp;<code>InitializationInput</code>&nbsp;から割り当てられたシャードのID等を取得する事ができます。</p>



<p>Scalaでの実装例:</p>


<pre class="language-scala hljs title: ; notranslate" title="">
class RecordProcessor extends IRecordProcessor {

  override def initialize(initializationInput: InitializationInput): Unit = {
    shardId = initializationInput.getShardId

    println(s&quot;Initialized processor for $shardId&quot;)
  }
  
  // ...
  
}
</pre>


<h4 id="processRecords0">processRecords</h4>



<p>Kinesisストリームからレコードを受け取ると実行されます。アプリケーションが遅延なく正常にストリームを消費している場合、ストリームにデータがPushされるとすぐに実行されます。<br>また、ここではあまり深く触れませんが、同じくAWSから提供されているKinesis Producer Libraryと言う、Kinesisにデータを投入する為のライブラリでは、複数のレコードを可能な限り単一のレコードに集約して処理するので、コンシューマ側の責務としてこの集約の解除を行わないといけないのですが、KCLではこの処理も自動的に行なってくれます。</p>



<p><code>ProcessRecordsInput</code>&nbsp;から受信した全てのレコードをList形式で取り出す事ができるので、後はアプリケーション側でレコードを処理するだけとなります。</p>



<p>Scalaでの実装例:</p>


<pre class="language-scala hljs title: ; notranslate" title="">
class RecordProcessor extends IRecordProcessor {
  
  // ...
  
  override def processRecords(processRecordsInput: ProcessRecordsInput): Unit = {
    val records = processRecordsInput.getRecords.asScala

    println(s&quot;Processing ${records.length} records, ${processRecordsInput.getMillisBehindLatest} msec behind latest&quot;)

    records.foreach { record =&gt;
      // ...
    }
  }
  
  // ...

}
</pre>


<h4 id="shutdown">shutdown</h4>



<p>その名の通り、レコードプロセッサが終了する時に呼ばれ、主に<strong>後述するチェックポイント処理</strong>の為に使います。<br><code>ShutdownInput</code>&nbsp;からはシャットダウンの理由を知る事ができます。シャットダウンの理由は2つあります:</p>



<ul><li class="">シャードの割り当てが別のプロセッサに移った時（他のインスタンスにスケールアウト、あるいはフェイルオーバーする際）</li><li class="">割り当てれているシャードが、リシャーディングにより終了した時</li></ul>



<p>それとは別に、KCLアプリケーションのプロセスが終了した事を検知するフックもあるのですが、そちらも後述します。</p>



<h2 id="チェックポイントについて">チェックポイントについて</h2>



<p>先述したとおり、Kinesisストリームは、コンシューマがどこまでデータを読み込んだかを管理しません。その代わりに、読み出しを開始するポイントをピンポイントに指定ができますので、アプリケーション側でどこまで読み込んだかを記録しておく必要があります。</p>



<p>KCLはチェックポイントをDynamoDB駆動で簡単に記録できる仕組みも用意されていて、これを使う事ができます。<br>ただし、チェックポイント記録の戦略はアプリケーションのニーズによって異なる為か、自動的には行われません。従って、処理は自前で実装する必要がありますが、&nbsp;<code>IRecordProcessor</code>&nbsp;のメソッド引数では簡単にチェックポイント記録が行えるようになっています。</p>



<h4 id="チェックポイント処理の共通化">チェックポイント処理の共通化</h4>



<p>チェックポイントの記録処理はDynamoDBを介して行われる為、書き込みスループット上昇時のスロットリングエラーに対処する必要があります。今回は、以下のようにDynamoDBへの過去込み失敗時には一定期間を置いてリトライする仕組みを準備しました:</p>


<pre class="language-scala hljs title: ; notranslate" title="">
class RecordProcessor extends IRecordProcessor {

  private val CHECKPOINT_RETRY_COUNT = 10
  
  // ...

  @scala.annotation.tailrec
  private def retryable(retryCount: Int)(f: =&gt; Unit): Unit = {
    try f
    catch {
      case e: Throwable =&gt;
        if (retryCount &gt; 0) {
          println(s&quot;An error occurred, will be retried at most $retryCount time(s)...&quot;, e)

          try Thread.sleep(3000)
          catch {
            case e: InterruptedException =&gt; println(&quot;Interrupted sleep&quot;, e)
          }

          retryable(retryCount - 1)(f)
        } else {
          println(s&quot;An error occurred&quot;, e)
        }
    }
  }
  
  private def checkpoint(checkpointer: IRecordProcessorCheckpointer): Unit =
    retryable(CHECKPOINT_RETRY_COUNT) {
      checkpointer.checkpoint()
    }
}
</pre>


<p>チェックポイントを記録する際は、&nbsp;<code>checkpoint</code>&nbsp;メソッドにチェックポインタ（各インターフェースメソッドで取り出せる）を渡す必要があります。</p>



<h4 id="processRecords">processRecords</h4>



<p>まずは、&nbsp;<code>processRecords</code>&nbsp;の実装を次のようにします:</p>


<pre class="language-scala hljs title: ; notranslate" title="">
class RecordProcessor extends IRecordProcessor {

  private val CHECKPOINT_INTERVAL_MILLIS = 30000L
  private var nextCheckpointTimeInMillis = 0L
  
  // ...

  override def processRecords(processRecordsInput: ProcessRecordsInput): Unit = {
    val records = processRecordsInput.getRecords.asScala

    println(s&quot;Processing ${records.length} records, ${processRecordsInput.getMillisBehindLatest} msec behind latest&quot;)

    records.foreach { record =&gt;
      // ...
    }

    // チェックポイント処理. DateTimeは `org.joda.time.DateTime` 
    if (DateTime.now().getMillis &gt; nextCheckpointTimeInMillis) {
      checkpoint(processRecordsInput.getCheckpointer)

      nextCheckpointTimeInMillis = DateTime.now().getMillis + CHECKPOINT_INTERVAL_MILLIS
    }
  }
  
  // ...
}
</pre>


<p>先程のprocessRecordsのサンプルに処理を追加しました。今回のポイントとしては以下の2点です:</p>



<ul><li class="">全てのレコードが正常に処理された場合のみチェックポイントを記録している<ul><li class="">処理中に例外が発生した場合は記録を行わない</li></ul></li><li class="">30秒以内に次のprocessRecordsが実行された際は記録は行わない<ul><li class="">DynamoDBのスロットリング軽減の為</li></ul></li></ul>



<p>ただし、これが正解と言うわけではありません。先述の通り、チェックポイントの戦略は多種多様です。例えば、全てのレコード (<code>processRecordsInput.getRecords</code>&nbsp;の要素) はシーケンスナンバーを保持しており、これをチェックポインタにわたす事で、ピンポイントにそのレコードまでを記録する事が可能です。</p>



<p>以下はシンプルな一例です (※今回はこの戦略を採用していないので自前実装した&nbsp;<code>checkpoiot</code>&nbsp;は使ってません):</p>


<pre class="language-scala hljs title: ; notranslate" title="">
var lastSequenceNumber = &quot;&quot;

records.foreach { record =&gt;
  try {
    // ...

    lastSequenceNumber = record.getSequenceNumber
  }
  catch {
    case e: Throable =&gt; {
      if (lastSequenceNumber.nonEmpty) 
        processRecordsInput.getCheckpointer.checkpoint(lastSequenceNumber)

      throw e
    }
  }
}

if (lastSequenceNumber.nonEmpty) 
  processRecordsInput.getCheckpointer.checkpoint(lastSequenceNumber)
</pre>


<p>レコード処理で例外が発生した時点で、正常に処理できた最後のチェックポイントを記録しています。</p>



<h4 id="shutdown1">shutdown</h4>



<p>さて、先程<a href="#shutdown">ちらっと書きました</a>が、チェックポイントの記録は&nbsp;<code>shutdown</code>&nbsp;時にも行う事ができます。<br>以下に例を示します:</p>


<pre class="language-scala hljs title: ; notranslate" title="">
class RecordProcessor extends IRecordProcessor {

  // ...

  override def shutdown(shutdownInput: ShutdownInput): Unit = {
    println(s&quot;Shutdown processor, reason: ${shutdownInput.getShutdownReason}&quot;)

    // シャットダウンの理由が &quot;TERMINATE&quot; の時だけ書き込み
    if (shutdownInput.getShutdownReason == ShutdownReason.TERMINATE) {
      checkpoint(shutdownInput.getCheckpointer)
    }
  }
}
</pre>


<p><code>shutdown</code>&nbsp;はレコードプロセッサが主に<a href="https://hackmd.io/iN8J0hLcRBSyacAOZwjoDA?view#shutdown">2つの理由で閉じられる時</a>にコールされますが、その内の理由が&nbsp;<code>TERMINATE</code>&nbsp;の時だけチェックポイントを記録します。<br><code>TERMINATE</code>&nbsp;はリシャーディングにより、割り当てられたシャードの全てのレコードを処理した時に呼ばれます。KCLアプリケーションでは、リシャーディング時に作られた新しいシャードへは、この終了するシャードのチェックポイントが記録されるまでレコードプロセッサが割り当てられないので、必ずこの処理は実装する必要があります。</p>



<blockquote class="wp-block-quote"><p>For a split or merge operation, the KCL won’t start processing the new shards until the processors for the original shards have called checkpoint to signal that all processing on the original shards is complete.</p><cite>https://docs.aws.amazon.com/streams/latest/dev/kinesis-record-processor-implementation-app-java.html#kinesis-record-processor-implementation-interface-java</cite></blockquote>



<p>反対にもう1つの理由である&nbsp;<code>ZOMBIE</code>&nbsp;の時はチェックポイントの記録は行ってはいけません。この理由でプロセッサが閉じられるのは、スケールアウト、またはフェイルオーバーにより他のプロセッサにシャードの割り当てが奪われるケースであり、すでに新しいプロセッサがレコードの処理を開始している可能性がある為です。</p>



<blockquote class="wp-block-quote"><p>Applications SHOULD NOT checkpoint their progress (as another record processor may have already started processing data).</p><cite>https://github.com/awslabs/amazon-kinesis-client/blob/8873b1346ff033de01fa1a237c0436d8fb762d9a/amazon-kinesis-client/src/main/java/software/amazon/kinesis/lifecycle/ShutdownReason.java#L36-L37</cite></blockquote>



<h5 id="shutdownRequested">shutdownRequested</h5>



<p>さて、KCLにはワーカーそのものが終了する事による、レコードプロセッサの終了処理を作る事もできます。通常、Kinesisストリームのコンシューマーは24/7で稼働するのでワーカーが終了する事はまれですが、ユースケースとして必要であればここでもチェックポイントを記録できます。</p>



<p>まず、レコードプロセッサ自体に&nbsp;<code>IShutdownNotificationAware</code>&nbsp;インターフェースを実装します。このインターフェースは単一の&nbsp;<code>shutdownRequested</code>&nbsp;メソッドを提供します:</p>


<pre class="language-scala hljs title: ; notranslate" title="">
class RecordProcessor extends IRecordProcessor with IShutdownNotificationAware {

  // ...

  override def shutdownRequested(checkpointer: IRecordProcessorCheckpointer): Unit = {
    println(&quot;Shutdown processor requested&quot;)

    checkpoint(checkpointer)
  }
  
  // ...
}
</pre>


<h2 id="エントリポイントの実装">エントリポイントの実装</h2>



<p>最後に、エントリポイントとなるメインクラスを準備すればOKです。</p>


<pre class="language-scala hljs title: ; notranslate" title="">
object MyConsumer extends App 

  val workerId = s&quot;${InetAddress.getLocalHost.getCanonicalHostName}:${UUID.randomUUID}&quot;
  val credentialsProvider = InstanceProfileCredentialsProvider.getInstance()
  val region = Regions.getCurrentRegion
  val kclConf = new KinesisClientLibConfiguration(cfg.kclApplicationName, cfg.kclStreamName, credentialsProvider, workerId)
    .withInitialPositionInStream(InitialPositionInStream.TRIM_HORIZON)
    .withRegionName(region)

  val recordProcessorFactory = new IRecordProcessorFactory {
    override def createProcessor: IRecordProcessor = new RecordProcessor()
  }

  val worker = new Worker.Builder()
    .recordProcessorFactory(recordProcessorFactory)
    .config(kclConf)
    .build()

  // Javaプロセスの終了を検出し、ワーカーを安全にシャットダウンする. ただし90秒以内に終了できなければ強制終了とする.
  // レコードプロセッサの `requestedShutdown` が呼ばれる.
  sys.addShutdownHook {
    info(&quot;Shutting down...&quot;)

    try {
      Await.result(
        Future(worker.startGracefulShutdown().get()),
        Duration(90, SECONDS)
      )
    } catch {
      case _: TimeoutException =&gt; println(&quot;Shutdown duration timed out&quot;)
    }
  }

  worker.run()
</pre>


<p>InitialPositionについては、これもユースケースによるのですが、今回は極力取りこぼしをなくす為にTRIM_HORIZONにしました。また、今回はワーカーを安全にシャットダウンできるようにJavaのシャットダウンフックを利用しています。</p>



<h2 id="運用について">運用について</h2>



<p>運用面でも色々学びが多かったのですが、それはまた後日別に書く事にします。</p>
</div><p class="post__date-and-author">May 14, 2020 - posted by <a href="/blog-foo/author/issei">issei_m</a></p><div style="margin-top:4rem"><div><h3>Tags</h3><div class="tag__container"><div class="tag__item"><a class="tag__link" href="/blog-foo/tags/aws/">AWS</a></div><div class="tag__item"><a class="tag__link" href="/blog-foo/tags/kcl/">KCL</a></div><div class="tag__item"><a class="tag__link" href="/blog-foo/tags/kinesis/">Kinesis</a></div><div class="tag__item"><a class="tag__link" href="/blog-foo/tags/scala/">Scala</a></div></div></div></div></section><section class="section"><div class="sharing-buttons"><button aria-label="facebook" class="react-share__ShareButton sharing-buttons__item" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="48" height="48"><circle cx="32" cy="32" r="31" fill="#3b5998"></circle><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton sharing-buttons__item" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="48" height="48"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="email" class="react-share__ShareButton sharing-buttons__item" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="48" height="48"><circle cx="32" cy="32" r="31" fill="#7f7f7f"></circle><path d="M17,22v20h30V22H17z M41.1,25L32,32.1L22.9,25H41.1z M20,39V26.6l12,9.3l12-9.3V39H20z" fill="white"></path></svg></button></div></section><section class="section"><div class="post-link"><a class="post-link__left" href="/blog-foo/2020/05/21/how-to-deal-with-non-24-7-kcl-consumer/"><h3 class="post-link__title">← 前の投稿</h3><p class="post-link__link-text">24時間稼働でないKinesisストリームの運用で手こずった点</p></a><a class="post-link__right" href="/blog-foo/2020/05/12/rails-app-in-docker-on-azure-app-service/"><h3 class="post-link__title">次の投稿 →</h3><p class="post-link__link-text">Azure App Service + Docker で Rails アプリを動かす</p></a></div></section><section class="section section--gray"><a class="banner__image-wrapper" href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer"><img class="banner__image banner__image--medium" src="/img/recruit-banner-medium.jpg" alt="we are hiring"/></a><h2>優秀な技術者と一緒に、好きな場所で働きませんか</h2><p>株式会社もばらぶでは、優秀で意欲に溢れる方を常に求めています。働く場所は自由、働く時間も柔軟に選択可能です。</p><p>現在、以下の職種を募集中です。ご興味のある方は、リンク先をご参照下さい。</p><ul><li><a href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer">ソフトウェアエンジニア</a></li><li><a href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer">デザイナー</a></li><li><a href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer">プロジェクトマネージャー</a></li></ul></section><section class="section"></section><section class="section"><div><h3>コメントを残す</h3><form class="comment-form"><input type="text" class="comment-form__input" name="name" placeholder="お名前（必須）"/><input type="text" class="comment-form__input" name="email" placeholder="メールアドレス(必須・公開されません)"/><textarea class="comment-form__input" name="body" cols="39" rows="4" placeholder="コメント（必須）"></textarea><button class="comment-form__button" type="submit">コメントを送信</button></form></div></section></div></div><aside class="sidebar-container"><div class="widget"><div class="widget__contents"><a class="banner__image-wrapper" href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer"><img class="banner__image" src="/img/recruit-banner-medium.jpg" alt="we are hiring"/></a></div></div><div class="widget"><h4 class="widget__title">最近の投稿</h4><div class="widget__contents"><ul><li><a href="/blog-foo/2020/09/24/scala-error-handling-option-either">Scala の Option, Either とエラー処理</a></li><li><a href="/blog-foo/2020/09/23/%e9%9d%99%e7%9a%84%e3%83%87%e3%83%bc%e3%82%bf%e3%83%99%e3%83%bc%e3%82%b9%e3%81%a8%e5%8b%95%e7%9a%84%e3%83%87%e3%83%bc%e3%82%bf%e3%83%99%e3%83%bc%e3%82%b9%ef%bc%88spark-sql%e3%81%ae%e5%b0%8f%e3%83%8d">静的データベースと動的データベース（Spark SQLの小ネタ）</a></li><li><a href="/blog-foo/2020/09/17/kedro%e8%a7%a6%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f">kedro触ってみた</a></li><li><a href="/blog-foo/2020/09/16/bert%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%e5%8b%89%e5%bc%b7%e3%81%97%e3%81%9f%e3%81%93%e3%81%a8%e3%81%be%e3%81%a8%e3%82%81-3-%e8%87%aa%e5%b7%b1%e6%95%99%e5%b8%ab%e5%ad%a6%e7%bf%92%e3%81%a8%e6%b1%8e">BERTについて勉強したことまとめ (3) 自己教師学習と汎用性について</a></li><li><a href="/blog-foo/2020/09/15/manage-aks-secrets-with-azure-key-vault">AKS上のKubernetesの秘匿情報をAzure Key Vaultで管理する方法</a></li></ul></div></div><div class="widget"><h4 class="widget__title">アーカイブ</h4><div class="widget__contents"><ul><li><a href="/blog-foo/archives/2020/09">2020年09月</a></li><li><a href="/blog-foo/archives/2020/08">2020年08月</a></li><li><a href="/blog-foo/archives/2020/07">2020年07月</a></li><li><a href="/blog-foo/archives/2020/06">2020年06月</a></li><li><a href="/blog-foo/archives/2020/05">2020年05月</a></li><li><a href="/blog-foo/archives/2020/04">2020年04月</a></li><li><a href="/blog-foo/archives/2020/03">2020年03月</a></li><li><a href="/blog-foo/archives/2020/02">2020年02月</a></li><li><a href="/blog-foo/archives/2019/12">2019年12月</a></li><li><a href="/blog-foo/archives/2019/11">2019年11月</a></li><li><a href="/blog-foo/archives/2019/10">2019年10月</a></li><li><a href="/blog-foo/archives/2019/09">2019年09月</a></li><li><a href="/blog-foo/archives/2019/08">2019年08月</a></li><li><a href="/blog-foo/archives/2019/07">2019年07月</a></li><li><a href="/blog-foo/archives/2019/06">2019年06月</a></li><li><a href="/blog-foo/archives/2019/05">2019年05月</a></li><li><a href="/blog-foo/archives/2019/04">2019年04月</a></li><li><a href="/blog-foo/archives/2019/03">2019年03月</a></li><li><a href="/blog-foo/archives/2019/02">2019年02月</a></li><li><a href="/blog-foo/archives/2019/01">2019年01月</a></li><li><a href="/blog-foo/archives/2018/12">2018年12月</a></li><li><a href="/blog-foo/archives/2018/11">2018年11月</a></li><li><a href="/blog-foo/archives/2018/10">2018年10月</a></li><li><a href="/blog-foo/archives/2018/09">2018年09月</a></li><li><a href="/blog-foo/archives/2018/08">2018年08月</a></li><li><a href="/blog-foo/archives/2018/07">2018年07月</a></li><li><a href="/blog-foo/archives/2018/06">2018年06月</a></li><li><a href="/blog-foo/archives/2018/05">2018年05月</a></li><li><a href="/blog-foo/archives/2018/01">2018年01月</a></li><li><a href="/blog-foo/archives/2017/12">2017年12月</a></li><li><a href="/blog-foo/archives/2017/11">2017年11月</a></li></ul></div></div><div class="widget"><h4 class="widget__title">タグ</h4><div class="widget__contents"><div class="tag__container"><div class="tag__item"><a href="/blog-foo/tags/aws/">aws (19)</a></div><div class="tag__item"><a href="/blog-foo/tags/lambda/">lambda (10)</a></div><div class="tag__item"><a href="/blog-foo/tags/scala/">scala (8)</a></div><div class="tag__item"><a href="/blog-foo/tags/serverless/">serverless (7)</a></div><div class="tag__item"><a href="/blog-foo/tags/s3/">s3 (5)</a></div><div class="tag__item"><a href="/blog-foo/tags/機械学習/">機械学習 (5)</a></div><div class="tag__item"><a href="/blog-foo/tags/mod_wsgi/">mod_wsgi (4)</a></div><div class="tag__item"><a href="/blog-foo/tags/ruby-on-rails/">ruby-on-rails (4)</a></div><div class="tag__item"><a href="/blog-foo/tags/spark/">spark (4)</a></div><div class="tag__item"><a href="/blog-foo/tags/ansible/">ansible (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/cli/">cli (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/docker/">docker (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/java/">java (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/kubernetes/">kubernetes (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/laravel/">laravel (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/node-js/">node-js (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/python/">python (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/rails/">rails (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/react-native/">react-native (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/scraping/">scraping (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/terraform/">terraform (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/自然言語処理/">自然言語処理 (3)</a></div><div class="tag__item"><a href="/blog-foo/tags/aws-cli/">aws-cli (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/aws-deep-learning-ami/">aws-deep-learning-ami (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/azure/">azure (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/bert/">bert (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/bug/">bug (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/centos/">centos (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/collection/">collection (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/database/">database (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/debug/">debug (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/ec2/">ec2 (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/eks/">eks (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/github/">github (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/iam/">iam (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/javascript/">javascript (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/k8s/">k8s (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/kinesis/">kinesis (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/machine-learning/">machine-learning (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/nlp/">nlp (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/openssl/">openssl (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/option/">option (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/php/">php (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/rds/">rds (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/ruby/">ruby (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/security/">security (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/typescript/">typescript (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/ubuntu/">ubuntu (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/vagrant/">vagrant (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/virtualbox/">virtualbox (2)</a></div><div class="tag__item"><a href="/blog-foo/tags/windows/">windows (2)</a></div></div></div></div></aside></div></main><footer class="footer"><div class="footer__inner container"><div class="footer__logo-wrapper"><img class="footer__logo-image" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNDAgMjQwIj48cG9seWdvbiBwb2ludHM9IjAgMjYuNjcgMTMuMzMgMjYuNjcgMTMuMzMgNDAgMCA0MCAwIDY2LjY3IDEzLjMzIDY2LjY3IDEzLjMzIDEwNi42NyAxMDYuNjcgMTA2LjY3IDEwNi42NyA4MCA0MCA4MCA0MCA2Ni42NyAxMDYuNjcgNjYuNjcgMTA2LjY3IDQwIDQwIDQwIDQwIDI2LjY3IDEwNi42NyAyNi42NyAxMDYuNjcgMCAwIDAgMCAyNi42NyIvPjxyZWN0IHg9IjQwIiB5PSIxMzMuMzMiIHdpZHRoPSI2Ni42NyIgaGVpZ2h0PSIyNi42NyIvPjxwb2x5Z29uIHBvaW50cz0iMjYuNjcgMTMzLjMzIDAgMTMzLjMzIDAgMjAwIDI2LjY3IDIwMCA4MCAyMDAgODAgMjEzLjMzIDAgMjEzLjMzIDAgMjQwIDEwNi42NyAyNDAgMTA2LjY3IDE3My4zMyAyNi42NyAxNzMuMzMgMjYuNjcgMTMzLjMzIi8+PHBvbHlnb24gcG9pbnRzPSIxMzMuMzMgMTYwIDE3My4zMyAxNjAgMTczLjMzIDI0MCAyMDAgMjQwIDIwMCAxMzMuMzMgMTMzLjMzIDEzMy4zMyAxMzMuMzMgMTYwIi8+PHJlY3QgeD0iMTMzLjMzIiB5PSIxNzMuMzMiIHdpZHRoPSIyNi42NyIgaGVpZ2h0PSI2Ni42NyIvPjxyZWN0IHg9IjIxMy4zMyIgeT0iMTczLjMzIiB3aWR0aD0iMjYuNjciIGhlaWdodD0iNjYuNjciLz48cmVjdCB4PSIyMDYuNjciIHk9IjEzMy4zMyIgd2lkdGg9IjEzLjMzIiBoZWlnaHQ9IjEzLjMzIi8+PHJlY3QgeD0iMjI2LjY3IiB5PSIxMzMuMzMiIHdpZHRoPSIxMy4zMyIgaGVpZ2h0PSIxMy4zMyIvPjxyZWN0IHg9IjEzMy4zMyIgd2lkdGg9IjI2LjY3IiBoZWlnaHQ9IjEwNi42NyIvPjxyZWN0IHg9IjIwNi42NyIgd2lkdGg9IjEzLjMzIiBoZWlnaHQ9IjEzLjMzIi8+PHJlY3QgeD0iMjI2LjY3IiB3aWR0aD0iMTMuMzMiIGhlaWdodD0iMTMuMzMiLz48cGF0aCBkPSJNMjAwLDBIMTczLjMzVjI2LjY3aDQwVjQwaC00MHY2Ni42N0gyNDBWMjBIMjAwWm0xMy4zMyw4MEgyMDBWNjYuNjdoMTMuMzNaIi8+PC9zdmc+" alt="もばらぶ"/></div><div class="footer__column-container"><div class="footer__column"><h4 class="footer__column-title">会社概要</h4><p>株式会社もばらぶ</p><p>設立: 2013年6月</p></div><div class="footer__column"><h4 class="footer__column-title">業務内容</h4><p><a href="https://mobalab.net/services/" target="_blank" rel="noopener noreferrer">Webサービス開発</a></p><p><a href="https://mobalab.net/services/" target="_blank" rel="noopener noreferrer">自社サービス</a></p><p><a href="https://mobalab.net/services/" target="_blank" rel="noopener noreferrer">受託開発</a></p><p><a href="https://mobalab.net/services/" target="_blank" rel="noopener noreferrer">中小企業のIT化支援</a></p></div><div class="footer__column"><h4 class="footer__column-title">リンク</h4><p><a href="https://mobalab.net" target="_blank" rel="noopener noreferrer">株式会社もばらぶウェブサイト</a></p><p><a href="https://blog.mobalab.net/" target="_blank" rel="noopener noreferrer">公式ブログ「もばらぶん」</a></p></div><div class="footer__column"><h4 class="footer__column-title">採用情報</h4><p><a href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer">プロジェクトマネージャー(リモート)</a></p><p><a href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer">ソフトウェアエンジニア(リモート)</a></p><p><a href="https://mobalab.net/recruit/" target="_blank" rel="noopener noreferrer">デザイナー(リモート)</a></p></div></div></div><div class="footer__bottom-area"><div class="footer__copyright">© Mobalab, KK 2020</div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020/05/14/create-kinesis-consumer-using-kcl-in-scala/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-aad2f32fe503f88f81aa.js"],"component---src-pages-404-js":["/component---src-pages-404-js-3ecfa6f461f2fbf8d1cf.js"],"component---src-templates-author-js":["/component---src-templates-author-js-96473aa85a451f46bba7.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-e0cd2f4e8a1b4d4c024c.js"],"component---src-templates-category-js":["/component---src-templates-category-js-8327246dc1124f94d530.js"],"component---src-templates-monthly-archive-js":["/component---src-templates-monthly-archive-js-5426866dd5a885424923.js"],"component---src-templates-page-js":["/component---src-templates-page-js-ffa75515ea9d1f8efb9a.js"],"component---src-templates-post-js":["/component---src-templates-post-js-9fbfa639a23c74cb9bb9.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-28e85cb989fb8ce86070.js"]};/*]]>*/</script><script src="/blog-foo/component---src-templates-post-js-9fbfa639a23c74cb9bb9.js" async=""></script><script src="/blog-foo/commons-e1b0c49c3875256839c2.js" async=""></script><script src="/blog-foo/2852872c-266d0f544f9db0fe515a.js" async=""></script><script src="/blog-foo/29107295-3eadfd8d28513cbe1d99.js" async=""></script><script src="/blog-foo/styles-da2d348018617ad0abdc.js" async=""></script><script src="/blog-foo/app-aad2f32fe503f88f81aa.js" async=""></script><script src="/blog-foo/framework-d53df25ab0068ecd1ffc.js" async=""></script><script src="/blog-foo/webpack-runtime-a0e8eddbaf72c74ae48d.js" async=""></script></body></html>